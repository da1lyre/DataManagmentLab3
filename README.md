# УД Лабораторная работа 3

## Описание схемы БД
БД представлена 4-мя таблицами:

#### _**САДОВОД**_
| ИДЕНТИФИКАТОР | ФАМИЛИЯ | ТОВАРИЩЕСТВО | ЛЬГОТА,% |
|---------------|---------|--------------|----------|

#### _**ПИТОМНИК**_
| ИДЕНТИФИКАТОР | НАЗВАНИЕ | ТОВАРИЩЕСТВО | КОМИССИОННЫЕ,% |
|---------------|----------|--------------|----------------|

#### _**РАСТЕНИЯ**_
| ИДЕНТИФИКАТОР | СОРТ | ОТКУДА | ЦЕНА, РУБ | КОЛ-ВО САЖЕНЦЕВ |
|---------------|------|--------|-----------|-----------------|

#### _**ПОКУПКА**_
| НОМЕР ВЕДОМОСТИ | ДАТА | САДОВОД | ПИТОМНИК | РАСТЕНИЕ | КОЛ-ВО | ИТОГОВАЯ СТОИМОСТЬ, РУБ |
|-----------------|------|---------|----------|----------|--------|-------------------------|
--- 
#### ER-диаграмма:

<img width="703" height="634" alt="изображение" src="https://github.com/user-attachments/assets/effd9a12-2798-45b6-aba0-345a4e2f9d1d"/>

## Задания и решения

## Уровень 1
### Задание 1.

##### Формулировка:
Дана схема базы данных в виде следующих отношений.  С помощью операторов SQL создать логическую структуру соответствующих таблиц для хранения в СУБД, используя известные средства поддержания целостности (NOT NULL, UNIQUE, и т.д.). Обосновать выбор типов данных и используемые средства поддержания целостности. При выборе подходящих типов данных использовать информацию о конкретных значениях полей БД (см. прил.1)
##### Решение:
[SQL код](./Level1/task1.sql)
##### Результат:
Были созданы 4 таблицы, согласно условию.

---

### Задание 2.

##### Формулировка:
Ввести в ранее созданные таблицы конкретные данные (см. прил. 1). Использовать скрипт-файл из операторов INSERT или вспомогательную утилиту.

##### Решение:
[SQL код](./Level1/task2.sql)

##### Результат:
Были вставлены во все таблицы указанные данные с помощью команд INSERT.

---

### Задание 3.

##### Формулировка:
Используя оператор SELECT создать запрос для вывода всех строк каждой таблицы. Проверить правильность ввода. При необходимости произвести коррекцию значений операторами INSERT, UPDATE, DELETE. 

##### Решение:
[SQL код](./Level1/task3.sql)

##### Результат:
Запрос 1
- <img width="631" height="188" alt="изображение" src="https://github.com/user-attachments/assets/5e844cc0-d305-40c2-b316-a68d6d1e693b" /><br>
Запрос 2
- <img width="624" height="218" alt="изображение" src="https://github.com/user-attachments/assets/7691cd1c-e7b7-4461-8234-499e1300af2c" /><br>
Запрос 3
- <img width="750" height="235" alt="изображение" src="https://github.com/user-attachments/assets/32857f35-7cac-4df1-b84b-3e9273b5b1ed" /><br>
Запрос 4
- <img width="809" height="529" alt="изображение" src="https://github.com/user-attachments/assets/4a8d99d0-a0f1-4955-9f01-96ef175d5f04" /><br>

---

### Задание 4.

##### Формулировка:
Создать запросы для вывода:
- всех различных названий товариществ;
- всех различных товариществ, откуда были получены в питомник растения;
- всех различных месяцы, когда производились покупки.

##### Решение:
[SQL код](./Level1/task4.sql)

##### Результат:
Запрос 1
- <img width="195" height="186" alt="изображение" src="https://github.com/user-attachments/assets/7f1b2fc1-fe78-46ce-8634-ecbc975fc83b" />
Запрос 2
- <img width="218" height="186" alt="изображение" src="https://github.com/user-attachments/assets/6f63e299-48ce-47ae-a52f-69dd5f493fd9" />
Запрос 3
- <img width="127" height="192" alt="изображение" src="https://github.com/user-attachments/assets/0b7c44de-0a12-4064-9d87-1d31c7968fb6" />

---

### Задание 5.

##### Формулировка:
Создать запросы для получения информации о:
- фамилиях и размере льгот всех садоводов из товарищества “Урожай”;
- фамилиях садоводов из товарищества “Радостное” или “Дальнее”;
- названиях  и стоимости растений,  которые покупались в питомниках товарищества “Мичуринское” или стоящих более 30000 руб..

##### Решение:
[SQL код](./Level1/task5.sql)

##### Результат:
Запрос 1 
- <img width="341" height="77" alt="изображение" src="https://github.com/user-attachments/assets/a2629d1e-1bb6-4bd8-bb1a-0242e058de91" />
Запрос 2
- <img width="223" height="99" alt="изображение" src="https://github.com/user-attachments/assets/1ff3e4f8-83c8-426a-a4d6-20a35ce97cff" />
Запрос 3
- <img width="335" height="238" alt="изображение" src="https://github.com/user-attachments/assets/7512d91d-88ec-457e-9272-71539b3626dd" />

---

### Задание 6.

##### Формулировка:
Для каждой покупки вывести следующие данные:
- фамилию садовода и название питомника, где производилась покупка;
- дату, фамилию садовода, льготу, название и количество купленных растений.

##### Решение:
[SQL код](./Level1/task6.sql)

##### Результат:
Запрос 1
- <img width="532" height="528" alt="изображение" src="https://github.com/user-attachments/assets/b915564a-7034-47f3-9140-33f7f0864b8e" />
Запрос 2
- <img width="862" height="529" alt="изображение" src="https://github.com/user-attachments/assets/288044ae-4fba-4976-bc33-16aa01cf4c9f" />

---

### Задание 7.

##### Формулировка:
Определить:
- номер ведомости, фамилию садовода и дату покупки в которой было куплено растений на сумму не меньшую чем 60000 руб.
- покупки, сделанные садоводом в питомниках своего товарищества не ранее марта месяца. Вывести фамилию, товарищество, дату. Произвести сортировку;
- питомники, расположенные в любом товариществе, кроме “Дальнего”, где покупали растения те, у кого льгота от 1 до 2 %;
- данные по покупке растений (название, питомник, купленное количество), приобретенных садоводами из того же товарищества, которое первоначально предоставило эти растения в питомник. Включить данные об итоговой стоимости и отсортировать по возрастанию. 

##### Решение:
[SQL код](./Level1/task7.sql)

##### Результат:
Запрос 1
- <img width="506" height="448" alt="изображение" src="https://github.com/user-attachments/assets/4a2109a4-601f-4cac-bd73-66cb62a302ea" />
Запрос 2
- <img width="676" height="100" alt="изображение" src="https://github.com/user-attachments/assets/8537d879-7171-456e-a299-1f49357aa204" />
Запрос 3
- <img width="509" height="130" alt="изображение" src="https://github.com/user-attachments/assets/9d4859f6-6a0d-42f4-9522-e7b991e63665" />
Запрос 4
- <img width="1099" height="75" alt="изображение" src="https://github.com/user-attachments/assets/494d480a-b553-4cfd-a649-0795994823fd" />

---
### Задание 8.

##### Формулировка:
Создать запрос для модификации всех значений столбца с суммарной величиной покупки, чтобы он содержал истинную сумму, оплачиваемую садоводом ( с учетом льгот). Вывести новые значения.

##### Решение:
[SQL код](./Level1/task8.sql)

##### Результат:
<img width="813" height="528" alt="изображение" src="https://github.com/user-attachments/assets/e6c075b2-aa2a-4d11-b67b-097f309c4d64" />

---

### Задание 9.

##### Формулировка:
Расширить таблицу с данными о покупке столбцом, содержащим величину коммисионных, получаемых питомником. Создать запрос для ввода конкретных значений во все строки таблицы покупок.

##### Решение:
[SQL код](./Level1/task9.sql)

##### Результат:
<img width="1093" height="529" alt="изображение" src="https://github.com/user-attachments/assets/4d94ac83-5b41-4556-bc03-55746bf47afc" />

---

## Уровень 2
### Задание 10.

##### Формулировка:
Используя операцию IN (NOT IN)  реализовать следующие запросы:
- запросы из задания 7.b, 7d;
- фамилии садоводов, которые не покупали растений в питомниках товарищества “Мичуринское”;
- фамилии садоводов, покупавших вишни.

##### Решение:
[SQL код](./Level2/task10.sql)

##### Результат:
Запрос 1
- <img width="681" height="102" alt="изображение" src="https://github.com/user-attachments/assets/d69a5fe7-1057-4ba9-b96e-7a52bdf06691" />
Запрос 2
- <img width="1102" height="75" alt="изображение" src="https://github.com/user-attachments/assets/1a23c989-dd35-43ea-8f05-d84597c6b6bc" />
Запрос 3
- <img width="514" height="102" alt="изображение" src="https://github.com/user-attachments/assets/b51fe51e-0f51-47e6-b38d-0459ecafb6eb" />
Запрос 4
- <img width="656" height="124" alt="изображение" src="https://github.com/user-attachments/assets/8a7b3bcf-5db8-4574-998d-bff10247dcb4" />

---

### Задание 11.

##### Формулировка:
Используя операции ALL-ANY реализовать следующие запросы:
- Названия растений, продающихся в питомниках “Дальнего” и имеющих наибольшую стоимость;
- фамилии садоводов имеющих льготы больше минимальных;
- названия питомников всех товариществ, кроме “Урожай”, для которых среди питомников товарищества “Урожай” есть такие, которые имеют такой же размер комиссионных;
- запрос задания 7.а.

##### Решение:
[SQL код](./Level2/task11.sql)

##### Результат:
Запрос 1
- <img width="350" height="77" alt="изображение" src="https://github.com/user-attachments/assets/ea88051b-e669-4f6a-83e9-fe4a344f11fa" />
Запрос 2
- <img width="340" height="132" alt="изображение" src="https://github.com/user-attachments/assets/137f9698-c9ce-4afe-9dac-5fe823c30188" />
Запрос 3
- <img width="519" height="129" alt="изображение" src="https://github.com/user-attachments/assets/64ffd021-8b8a-44ea-a27f-dea8de2de886" />
Запрос 4
- <img width="629" height="443" alt="изображение" src="https://github.com/user-attachments/assets/bc150ae4-ea81-4d48-994d-67011c0eb080" />

---

### Задание 12.

##### Формулировка:
Используя операцию UNION получить названия товариществ, где трудятся садоводы или расположены питомники.

##### Решение:
[SQL код](./Level2/task12.sql)

##### Результат:
<img width="248" height="179" alt="изображение" src="https://github.com/user-attachments/assets/06f3b832-0399-45d8-a921-87cf42311971" />

---

### Задание 13.

##### Формулировка:
Используя операцию EXISTS ( NOT EXISTS ) реализовать нижеследующие запросы. В случае, если для текущего состояния БД запрос будет выдавать пустое множество строк, требуется указать какие добавления в БД необходимо провести.
- найти садоводов, покупавших все растения товарищества “Солнечное” не позднее июня;
- найти растения, которые покупали все садоводы с размером льгот менее 3% из питомников товарищества “Урожай”;
- найти такие питомники, которые продавали растения всем садоводам со льготами;
- найти садоводов с размером льгот больше минимального, которые покупали растения во всех питомниках.

##### Решение:
[SQL код](./Level2/task13.sql)

##### Результат:
Запрос 1
- <img width="340" height="130" alt="изображение" src="https://github.com/user-attachments/assets/4b257115-a2eb-402e-8f3e-9005db6ba117" />
Запрос 2
- <img width="336" height="111" alt="изображение" src="https://github.com/user-attachments/assets/4fdac673-1293-41a9-a3b6-2aa42a6293d7" />
Запрос 3
- <img width="501" height="113" alt="изображение" src="https://github.com/user-attachments/assets/8ef0a3c8-fb6a-4e12-9134-a0b2dfefc23b" />
Запрос 4
- <img width="451" height="112" alt="изображение" src="https://github.com/user-attachments/assets/236bcea3-24c5-4508-8790-ab3a2fd96c82" />

---

### Задание 14.

##### Формулировка:
Реализовать запросы с использованием аггрегатных функций:
- определить количество различных растений, купленных садоводоами из дальнего в мае и июне;
- определить на какую суммарную стоимость было продано саженцев вишни;
- какие садоводы делали покупки на сумму выше средней;
- какие питомники продавали растения всем садоводам со льготами меньше средних.

##### Решение:
[SQL код](./Level2/task14.sql)
 
##### Результат:
Запрос 1
- <img width="301" height="70" alt="изображение" src="https://github.com/user-attachments/assets/c42548f6-da6e-49c2-9f8a-dc43102880ed" />
Запрос 2
- <img width="629" height="75" alt="изображение" src="https://github.com/user-attachments/assets/8d9828ea-6d88-47bd-9998-072aee318a8c" />
Запрос 3
- <img width="686" height="132" alt="изображение" src="https://github.com/user-attachments/assets/71bf7026-16b2-4139-9329-b6f4e6c22768" />
Запрос 4
- <img width="781" height="101" alt="изображение" src="https://github.com/user-attachments/assets/da860a5f-09c7-44fa-9ad4-ddf13ac94cc7" />

---

### Задание 15.

##### Формулировка:
Используя средства группировки реализовать следующие запросы:
- для каждого растения определить общее число различных покупателей;
- найти те месяца, когда из питомников Даьнего покупали растений на общую сумму более 700000;
- для каждой пары “садовод-растение” определить общее количество купленных саженцев;
- какие садоводы приобрели саженцев крыжовника на общую сумму более 300000.

##### Решение:
[SQL код](./Level2/task15.sql)

##### Результат:
Запрос 1
- <img width="603" height="211" alt="изображение" src="https://github.com/user-attachments/assets/9f139bad-119a-4f6e-98a7-3afd2ddfa561" />
Запрос 2
- <img width="315" height="74" alt="изображение" src="https://github.com/user-attachments/assets/95cdf22b-e005-4e7b-bf4c-1cc327dc13f4" />
Запрос 3
- <img width="1000" height="469" alt="изображение" src="https://github.com/user-attachments/assets/30803f2c-2fa6-44a9-bcf7-7d46e416468f" />
Запрос 4
- <img width="901" height="109" alt="изображение" src="https://github.com/user-attachments/assets/0c985f71-a150-42d0-8ec2-c75700cc25d7" />


